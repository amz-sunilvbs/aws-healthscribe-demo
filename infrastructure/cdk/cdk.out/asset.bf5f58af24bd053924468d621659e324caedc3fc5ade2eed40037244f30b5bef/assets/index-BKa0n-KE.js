const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-xRJ0uOrR.js","assets/index-w0oEGYbL.js","assets/index-mOZEd70N.css","assets/index-Chjiymov.js"])))=>i.map(i=>d[i]);
import{r as m,j as i,H as Je,S as H,B as $,ac as Ct,ad as je,a as ye,i as Et,ae as de,R as y,_ as De,k as yt,m as It,X as Zt,p as Tt,af as st,ag as Qt,n as V,ah as le,ai as en,K as _t,aj as tn,ak as nn,al as sn,am as rn,an as on,ao as an,P as cn,b as wt,ap as ln,J as dn,d as Mt,s as W,aq as un,ar as hn,as as pn,at as mn,au as gn,av as fn,aw as xn,ax as bn,ay as vn,az as Sn,aA as Cn,aB as En,aC as yn,aD as In,aE as Tn,aF as _n,aG as wn,aH as Mn,aI as jn,aJ as Rn,aK as Dn,aL as Pn,aM as An,aN as kn,aO as Nn,aP as On,aQ as Ln,aR as zn,aS as $n,aT as Hn,aU as Fn,aV as Bn,aW as Vn,aX as Un,aY as Wn,aZ as Jn,a_ as qn,a$ as Yn,b0 as Gn,b1 as Kn,b2 as Xn,b3 as Zn,b4 as Qn,b5 as es,b6 as ts,b7 as ns,b8 as ss,b9 as is,ba as U,bb as Pe,bc as rs,bd as os,be as as,bf as cs,bg as O,bh as S,bi as ae,bj as z,bk as P,bl as Ae,bm as ke,bn as Ne,bo as ls,bp as ds,f as Oe,v as us,L as Re,bq as Ce,br as hs,G as jt,bs as ps,bt as oe,Y as ms,V as gs,M as fs,F as xs,a9 as bs,ab as vs,u as Rt,bu as Ss,bv as Cs,C as Es,bw as ys,g as Is,bx as it,by as Ts}from"./index-w0oEGYbL.js";import{B as _s}from"./index-D5jmMl3Z.js";import{c as Dt,a as ws,b as Pt,d as We,e as Ms}from"./index-pxjt_Rts.js";import{c as js,S as At,T as kt,t as ne}from"./toTitleCase-DVAms8sd.js";import{E as Ee,C as rt}from"./index-e7Ck4pdV.js";import"./radio-button-6dabbkd3.js";function Rs(){const n=m.useRef(void 0),[e,t]=m.useState(!1),[s,r]=m.useState(0),[o,a]=m.useState(!1),[c,d]=m.useState({allSegmentIds:[],selectedSegmentId:""});return[n,e,t,s,r,o,a,c,d]}function Ds({jobDetails:n,setShowOutputModal:e,setDeleteModalActive:t}){async function s(r){let o="";if(r.id==="audio"?o=n?.Media?.MediaFileUri:r.id==="transcript"?o=n?.MedicalScribeOutput?.TranscriptFileUri:r.id==="summary"&&(o=n?.MedicalScribeOutput?.ClinicalDocumentUri),o){const a=await Ct(je(o));window.open(a,"_blank")}}return i.jsx(Je,{variant:"awsui-h1-sticky",actions:i.jsxs(H,{direction:"horizontal",size:"xs",children:[i.jsx(_s,{items:[{text:"Audio",id:"audio"},{text:"Transcript",id:"transcript"},{text:"Summary",id:"summary"}],onItemClick:({detail:r})=>s(r),children:"Download"}),i.jsx($,{onClick:()=>e(!0),children:"View HealthScribe Output"}),i.jsx($,{variant:"normal",onClick:()=>t(!0),children:"Delete"})]}),children:n?.MedicalScribeJobName})}const Ps="m",As="n",ks="p",_e={childDiv:Ps,scrollUpIcon:As,scrollDownIcon:ks};function Nt({containerTitle:n,text:e}){return i.jsx(ye,{header:i.jsx(Je,{variant:"h2",children:n}),children:i.jsxs("div",{className:_e.childDiv,children:[i.jsx(Et,{})," ",e]})})}function Ns(n,e){n!=null&&m.useEffect(()=>{const t=n.current;return t&&t.addEventListener("scroll",e),()=>{t?.removeEventListener("scroll",e)}},[n])}function Ot({containerTitle:n,containerActions:e=null,children:t}){const[s,r]=m.useState(!1),[o,a]=m.useState(!1),c=m.useRef(null);function d(g){const u=g.target,p=u.scrollTop>0;r(!!p);const l=u.scrollHeight-u.scrollTop===u.clientHeight;a(!l)}const h=js(d,300);return Ns(c,h),m.useEffect(()=>{if(c.current==null)return;const g=c.current;g.scrollHeight>g.clientHeight&&a(!0)},[c.current]),i.jsxs(ye,{header:i.jsx(Je,{variant:"h2",actions:e,children:n}),children:[s&&i.jsx("div",{className:_e.scrollUpIcon,children:i.jsx(de,{name:"angle-up",size:"medium"})}),i.jsx("div",{className:_e.childDiv,ref:c,children:t}),o&&i.jsx("div",{className:_e.scrollDownIcon,children:i.jsx(de,{name:"angle-down",size:"medium"})})]})}const Os="h",Ls="i",ot={hidescrollbar:Os,row:Ls},zs=y.forwardRef($s);function $s(n,e){var{position:t="right",size:s="medium",fixedWidth:r=!1,triggerType:o="text",dismissButton:a=!0,children:c,header:d,content:h,triggerAriaLabel:g,wrapTriggerText:u=!0,isInline:p=!1,renderWithPortal:l=!1,__onOpen:x,__internalRootRef:C=null,__closeAnalyticsAction:f}=n,w=De(n,["position","size","fixedWidth","triggerType","dismissButton","children","header","content","triggerAriaLabel","wrapTriggerText","isInline","renderWithPortal","__onOpen","__internalRootRef","__closeAnalyticsAction"]);const T=yt(w),b=m.useRef(null),I=m.useRef(null),v=m.useRef(null),D=It("popover")("dismissAriaLabel",w.dismissAriaLabel),[R,k]=m.useState(!1),M=m.useCallback(()=>{var A,B;["text","text-inline"].includes(o)?(A=b.current)===null||A===void 0||A.focus():b.current&&((B=Zt(b.current))===null||B===void 0||B.focus())},[o]),L=m.useCallback(()=>{Tt(x),k(!0)},[x]),F=m.useCallback(()=>{k(!1),M()},[M]),se=m.useCallback(A=>{const B=A.keyCode===st.escape,q=A.keyCode===st.tab;B&&R&&A.stopPropagation(),(q||B)&&k(!1)},[R]);m.useImperativeHandle(e,()=>({dismissPopover:F,focus:()=>{k(!1),M()}})),m.useEffect(()=>{if(!b.current)return;const A=b.current.ownerDocument,B=()=>{v.current===null&&k(!1)};return A.addEventListener("mousedown",B),()=>{A.removeEventListener("mousedown",B)}},[]);const ee=Qt(b),ue={ref:b,onClick:L,onKeyDown:se,className:V(le.trigger,le[`trigger-type-${o}`])},{tabIndex:j}=en(b),N=_t(),ie=y.createElement("div",{"aria-live":a?void 0:"polite","aria-atomic":a?void 0:!0,className:V(ee,!l&&le["popover-inline-content"]),"data-awsui-referrer-id":N},y.createElement(tn,{size:s,fixedWidth:r,position:t,trackRef:b,arrow:A=>y.createElement(nn,{position:A}),renderWithPortal:l,zIndex:l?7e3:void 0},y.createElement(sn.Provider,{value:{defaultVariant:"primary"}},y.createElement(rn,{dismissButton:a,dismissAriaLabel:D,header:d,onDismiss:F,overflowVisible:"both",closeAnalyticsAction:f},h)))),re=on(I,C);return y.createElement("span",Object.assign({},T,{className:V(le.root,T.className,o==="filtering-token"&&le["root-filtering-token"],p&&le["no-wrap"]),ref:re,onMouseDown:()=>{v.current=requestAnimationFrame(()=>{v.current=null})}}),["text","text-inline"].includes(o)?y.createElement("button",Object.assign({},ue,{className:V(ue.className,u===!1&&le["overflow-ellipsis"]),tabIndex:j,type:"button","aria-haspopup":"dialog",id:N,"aria-label":g}),c):y.createElement("span",Object.assign({},ue,{id:N}),c),R&&y.createElement(an,null,l?y.createElement(cn,null,ie):ie))}const Te=y.forwardRef((n,e)=>{var{position:t="right",size:s="medium",fixedWidth:r=!1,triggerType:o="text",dismissButton:a=!0,renderWithPortal:c=!1,wrapTriggerText:d=!0,header:h}=n,g=De(n,["position","size","fixedWidth","triggerType","dismissButton","renderWithPortal","wrapTriggerText","header"]);const u=wt("Popover",{props:{dismissButton:a,fixedWidth:r,position:t,renderWithPortal:c,size:s,triggerType:o}}),p=ln(g),l=m.useRef(null);return dn(e,l),y.createElement(zs,Object.assign({ref:l,header:h,position:t,size:s,fixedWidth:r,triggerType:o,dismissButton:a,renderWithPortal:c,wrapTriggerText:d},p,u))});Mt(Te,"Popover");function X({label:n,children:e}){return i.jsxs("div",{children:[i.jsx(W,{variant:"awsui-key-label",children:n}),i.jsx("div",{children:e})]})}const Hs=async(n,e,t)=>({operation:pn(e).operation,region:await hn(n.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function Fs(n){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"comprehendmedical",region:n.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}const Bs=n=>{const e=[];switch(n.operation){default:e.push(Fs(n))}return e},Vs=n=>{const e=un(n);return Object.assign(e,{})},Us=n=>Object.assign(n,{useDualstackEndpoint:n.useDualstackEndpoint??!1,useFipsEndpoint:n.useFipsEndpoint??!1,defaultSigningName:"comprehendmedical"}),Le={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},Ws="3.782.0",Js={version:Ws},Lt="required",Z="fn",Q="argv",xe="ref",at=!0,ct="isSet",Ie="booleanEquals",me="error",ve="endpoint",te="tree",qe="PartitionResult",lt={[Lt]:!1,type:"String"},dt={[Lt]:!0,default:!1,type:"Boolean"},ut={[xe]:"Endpoint"},zt={[Z]:Ie,[Q]:[{[xe]:"UseFIPS"},!0]},$t={[Z]:Ie,[Q]:[{[xe]:"UseDualStack"},!0]},G={},ht={[Z]:"getAttr",[Q]:[{[xe]:qe},"supportsFIPS"]},pt={[Z]:Ie,[Q]:[!0,{[Z]:"getAttr",[Q]:[{[xe]:qe},"supportsDualStack"]}]},mt=[zt],gt=[$t],ft=[{[xe]:"Region"}],qs={parameters:{Region:lt,UseDualStack:dt,UseFIPS:dt,Endpoint:lt},rules:[{conditions:[{[Z]:ct,[Q]:[ut]}],rules:[{conditions:mt,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:me},{conditions:gt,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:me},{endpoint:{url:ut,properties:G,headers:G},type:ve}],type:te},{conditions:[{[Z]:ct,[Q]:ft}],rules:[{conditions:[{[Z]:"aws.partition",[Q]:ft,assign:qe}],rules:[{conditions:[zt,$t],rules:[{conditions:[{[Z]:Ie,[Q]:[at,ht]},pt],rules:[{endpoint:{url:"https://comprehendmedical-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:G,headers:G},type:ve}],type:te},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:me}],type:te},{conditions:mt,rules:[{conditions:[{[Z]:Ie,[Q]:[ht,at]}],rules:[{endpoint:{url:"https://comprehendmedical-fips.{Region}.{PartitionResult#dnsSuffix}",properties:G,headers:G},type:ve}],type:te},{error:"FIPS is enabled but this partition does not support FIPS",type:me}],type:te},{conditions:gt,rules:[{conditions:[pt],rules:[{endpoint:{url:"https://comprehendmedical.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:G,headers:G},type:ve}],type:te},{error:"DualStack is enabled but this partition does not support DualStack",type:me}],type:te},{endpoint:{url:"https://comprehendmedical.{Region}.{PartitionResult#dnsSuffix}",properties:G,headers:G},type:ve}],type:te}],type:te},{error:"Invalid Configuration: Missing Region",type:me}]},Ys=qs,Gs=new mn({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),Ks=(n,e={})=>Gs.get(n,()=>gn(Ys,{endpointParams:n,logger:e.logger}));xn.aws=fn;const Xs=n=>({apiVersion:"2018-10-30",base64Decoder:n?.base64Decoder??In,base64Encoder:n?.base64Encoder??yn,disableHostPrefix:n?.disableHostPrefix??!1,endpointProvider:n?.endpointProvider??Ks,extensions:n?.extensions??[],httpAuthSchemeProvider:n?.httpAuthSchemeProvider??Bs,httpAuthSchemes:n?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new En}],logger:n?.logger??new Cn,serviceId:n?.serviceId??"ComprehendMedical",urlParser:n?.urlParser??Sn,utf8Decoder:n?.utf8Decoder??vn,utf8Encoder:n?.utf8Encoder??bn}),Zs=n=>{const e=Tn(n),t=()=>e().then(On),s=Xs(n);return{...s,...n,runtime:"browser",defaultsMode:e,bodyLengthChecker:n?.bodyLengthChecker??An,credentialDefaultProvider:n?.credentialDefaultProvider??(r=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:n?.defaultUserAgentProvider??Pn({serviceId:s.serviceId,clientVersion:Js.version}),maxAttempts:n?.maxAttempts??Dn,region:n?.region??Rn("Region is missing"),requestHandler:jn.create(n?.requestHandler??t),retryMode:n?.retryMode??(async()=>(await t()).retryMode||Mn),sha256:n?.sha256??wn,streamCollector:n?.streamCollector??_n,useDualstackEndpoint:n?.useDualstackEndpoint??(()=>Promise.resolve(Nn)),useFipsEndpoint:n?.useFipsEndpoint??(()=>Promise.resolve(kn))}},Qs=n=>{const e=n.httpAuthSchemes;let t=n.httpAuthSchemeProvider,s=n.credentials;return{setHttpAuthScheme(r){const o=e.findIndex(a=>a.schemeId===r.schemeId);o===-1?e.push(r):e.splice(o,1,r)},httpAuthSchemes(){return e},setHttpAuthSchemeProvider(r){t=r},httpAuthSchemeProvider(){return t},setCredentials(r){s=r},credentials(){return s}}},ei=n=>({httpAuthSchemes:n.httpAuthSchemes(),httpAuthSchemeProvider:n.httpAuthSchemeProvider(),credentials:n.credentials()}),ti=(n,e)=>{const t=Object.assign(Ln(n),zn(n),$n(n),Qs(n));return e.forEach(s=>s.configure(t)),Object.assign(n,Hn(t),Fn(t),Bn(t),ei(t))};class ni extends Vn{config;constructor(...[e]){const t=Zs(e||{});super(t),this.initConfig=t;const s=Us(t),r=Un(s),o=Wn(r),a=Jn(o),c=Yn(a),d=qn(c),h=Vs(d),g=ti(h,e?.extensions||[]);this.config=g,this.middlewareStack.use(Gn(this.config)),this.middlewareStack.use(Kn(this.config)),this.middlewareStack.use(Xn(this.config)),this.middlewareStack.use(Zn(this.config)),this.middlewareStack.use(Qn(this.config)),this.middlewareStack.use(es(this.config)),this.middlewareStack.use(ts(this.config,{httpAuthSchemeParametersProvider:Hs,identityProviderConfigProvider:async u=>new ns({"aws.auth#sigv4":u.credentials})})),this.middlewareStack.use(ss(this.config))}destroy(){super.destroy()}}class Y extends is{constructor(e){super(e),Object.setPrototypeOf(this,Y.prototype)}}class Ye extends Y{name="InternalServerException";$fault="server";Message;constructor(e){super({name:"InternalServerException",$fault:"server",...e}),Object.setPrototypeOf(this,Ye.prototype),this.Message=e.Message}}class Ge extends Y{name="InvalidRequestException";$fault="client";Message;constructor(e){super({name:"InvalidRequestException",$fault:"client",...e}),Object.setPrototypeOf(this,Ge.prototype),this.Message=e.Message}}class Ke extends Y{name="ResourceNotFoundException";$fault="client";Message;constructor(e){super({name:"ResourceNotFoundException",$fault:"client",...e}),Object.setPrototypeOf(this,Ke.prototype),this.Message=e.Message}}class Xe extends Y{name="TooManyRequestsException";$fault="client";Message;constructor(e){super({name:"TooManyRequestsException",$fault:"client",...e}),Object.setPrototypeOf(this,Xe.prototype),this.Message=e.Message}}class Ze extends Y{name="InvalidEncodingException";$fault="client";Message;constructor(e){super({name:"InvalidEncodingException",$fault:"client",...e}),Object.setPrototypeOf(this,Ze.prototype),this.Message=e.Message}}class Qe extends Y{name="ServiceUnavailableException";$fault="server";Message;constructor(e){super({name:"ServiceUnavailableException",$fault:"server",...e}),Object.setPrototypeOf(this,Qe.prototype),this.Message=e.Message}}class et extends Y{name="TextSizeLimitExceededException";$fault="client";Message;constructor(e){super({name:"TextSizeLimitExceededException",$fault:"client",...e}),Object.setPrototypeOf(this,et.prototype),this.Message=e.Message}}class tt extends Y{name="ValidationException";$fault="client";Message;constructor(e){super({name:"ValidationException",$fault:"client",...e}),Object.setPrototypeOf(this,tt.prototype),this.Message=e.Message}}const si=async(n,e)=>{const t=He("DetectEntitiesV2");let s;return s=JSON.stringify(U(n)),$e(e,t,"/",void 0,s)},ii=async(n,e)=>{const t=He("InferICD10CM");let s;return s=JSON.stringify(U(n)),$e(e,t,"/",void 0,s)},ri=async(n,e)=>{const t=He("InferRxNorm");let s;return s=JSON.stringify(U(n)),$e(e,t,"/",void 0,s)},oi=async(n,e)=>{const t=He("InferSNOMEDCT");let s;return s=JSON.stringify(U(n)),$e(e,t,"/",void 0,s)},ai=async(n,e)=>{if(n.statusCode>=300)return ze(n,e);const t=await Pe(n.body,e);let s={};return s=Si(t),{$metadata:J(n),...s}},ci=async(n,e)=>{if(n.statusCode>=300)return ze(n,e);const t=await Pe(n.body,e);let s={};return s=Ri(t),{$metadata:J(n),...s}},li=async(n,e)=>{if(n.statusCode>=300)return ze(n,e);const t=await Pe(n.body,e);let s={};return s=Di(t),{$metadata:J(n),...s}},di=async(n,e)=>{if(n.statusCode>=300)return ze(n,e);const t=await Pe(n.body,e);let s={};return s=Pi(t),{$metadata:J(n),...s}},ze=async(n,e)=>{const t={...n,body:await os(n.body,e)},s=as(n,t.body);switch(s){case"InternalServerException":case"com.amazonaws.comprehendmedical#InternalServerException":throw await ui(t);case"InvalidRequestException":case"com.amazonaws.comprehendmedical#InvalidRequestException":throw await pi(t);case"ResourceNotFoundException":case"com.amazonaws.comprehendmedical#ResourceNotFoundException":throw await mi(t);case"TooManyRequestsException":case"com.amazonaws.comprehendmedical#TooManyRequestsException":throw await xi(t);case"InvalidEncodingException":case"com.amazonaws.comprehendmedical#InvalidEncodingException":throw await hi(t);case"ServiceUnavailableException":case"com.amazonaws.comprehendmedical#ServiceUnavailableException":throw await gi(t);case"TextSizeLimitExceededException":case"com.amazonaws.comprehendmedical#TextSizeLimitExceededException":throw await fi(t);case"ValidationException":case"com.amazonaws.comprehendmedical#ValidationException":throw await bi(t);default:const r=t.body;return Gi({output:n,parsedBody:r,errorCode:s})}},ui=async(n,e)=>{const t=n.body,s=U(t),r=new Ye({$metadata:J(n),...s});return ae(r,t)},hi=async(n,e)=>{const t=n.body,s=U(t),r=new Ze({$metadata:J(n),...s});return ae(r,t)},pi=async(n,e)=>{const t=n.body,s=U(t),r=new Ge({$metadata:J(n),...s});return ae(r,t)},mi=async(n,e)=>{const t=n.body,s=U(t),r=new Ke({$metadata:J(n),...s});return ae(r,t)},gi=async(n,e)=>{const t=n.body,s=U(t),r=new Qe({$metadata:J(n),...s});return ae(r,t)},fi=async(n,e)=>{const t=n.body,s=U(t),r=new et({$metadata:J(n),...s});return ae(r,t)},xi=async(n,e)=>{const t=n.body,s=U(t),r=new Xe({$metadata:J(n),...s});return ae(r,t)},bi=async(n,e)=>{const t=n.body,s=U(t),r=new tt({$metadata:J(n),...s});return ae(r,t)},Ht=(n,e)=>O(n,{BeginOffset:P,Category:S,EndOffset:P,Id:P,RelationshipScore:z,RelationshipType:S,Score:z,Text:S,Traits:t=>Wt(t),Type:S}),vi=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Ht(s)),Si=(n,e)=>O(n,{Entities:t=>Ei(t),ModelVersion:S,PaginationToken:S,UnmappedAttributes:t=>Yi(t)}),Ci=(n,e)=>O(n,{Attributes:t=>vi(t),BeginOffset:P,Category:S,EndOffset:P,Id:P,Score:z,Text:S,Traits:t=>Wt(t),Type:S}),Ei=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Ci(s)),yi=(n,e)=>O(n,{BeginOffset:P,Category:S,EndOffset:P,Id:P,RelationshipScore:z,RelationshipType:S,Score:z,Text:S,Traits:t=>Ft(t),Type:S}),Ii=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>yi(s)),Ti=(n,e)=>O(n,{Code:S,Description:S,Score:z}),_i=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Ti(s)),wi=(n,e)=>O(n,{Attributes:t=>Ii(t),BeginOffset:P,Category:S,EndOffset:P,ICD10CMConcepts:t=>_i(t),Id:P,Score:z,Text:S,Traits:t=>Ft(t),Type:S}),Mi=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>wi(s)),ji=(n,e)=>O(n,{Name:S,Score:z}),Ft=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>ji(s)),Ri=(n,e)=>O(n,{Entities:t=>Mi(t),ModelVersion:S,PaginationToken:S}),Di=(n,e)=>O(n,{Entities:t=>zi(t),ModelVersion:S,PaginationToken:S}),Pi=(n,e)=>O(n,{Characters:U,Entities:t=>Ui(t),ModelVersion:S,PaginationToken:S,SNOMEDCTDetails:U}),Ai=(n,e)=>O(n,{BeginOffset:P,EndOffset:P,Id:P,RelationshipScore:z,Score:z,Text:S,Traits:t=>Bt(t),Type:S}),ki=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Ai(s)),Ni=(n,e)=>O(n,{Code:S,Description:S,Score:z}),Oi=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Ni(s)),Li=(n,e)=>O(n,{Attributes:t=>ki(t),BeginOffset:P,Category:S,EndOffset:P,Id:P,RxNormConcepts:t=>Oi(t),Score:z,Text:S,Traits:t=>Bt(t),Type:S}),zi=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Li(s)),$i=(n,e)=>O(n,{Name:S,Score:z}),Bt=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>$i(s)),Hi=(n,e)=>O(n,{BeginOffset:P,Category:S,EndOffset:P,Id:P,RelationshipScore:z,RelationshipType:S,SNOMEDCTConcepts:t=>Vt(t),Score:z,Text:S,Traits:t=>Ut(t),Type:S}),Fi=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Hi(s)),Bi=(n,e)=>O(n,{Code:S,Description:S,Score:z}),Vt=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Bi(s)),Vi=(n,e)=>O(n,{Attributes:t=>Fi(t),BeginOffset:P,Category:S,EndOffset:P,Id:P,SNOMEDCTConcepts:t=>Vt(t),Score:z,Text:S,Traits:t=>Ut(t),Type:S}),Ui=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Vi(s)),Wi=(n,e)=>O(n,{Name:S,Score:z}),Ut=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Wi(s)),Ji=(n,e)=>O(n,{Name:S,Score:z}),Wt=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>Ji(s)),qi=(n,e)=>O(n,{Attribute:t=>Ht(t),Type:S}),Yi=(n,e)=>(n||[]).filter(s=>s!=null).map(s=>qi(s)),J=n=>({httpStatusCode:n.statusCode,requestId:n.headers["x-amzn-requestid"]??n.headers["x-amzn-request-id"]??n.headers["x-amz-request-id"],extendedRequestId:n.headers["x-amz-id-2"],cfId:n.headers["x-amz-cf-id"]}),Gi=cs(Y),$e=async(n,e,t,s,r)=>{const{hostname:o,protocol:a="https",port:c,path:d}=await n.endpoint(),h={protocol:a,hostname:o,port:c,method:"POST",path:d.endsWith("/")?d.slice(0,-1)+t:d+t,headers:e};return r!==void 0&&(h.body=r),new rs(h)};function He(n){return{"content-type":"application/x-amz-json-1.1","x-amz-target":`ComprehendMedical_20181030.${n}`}}class Ki extends Ae.classBuilder().ep(Le).m(function(e,t,s,r){return[ke(s,this.serialize,this.deserialize),Ne(s,e.getEndpointParameterInstructions())]}).s("ComprehendMedical_20181030","DetectEntitiesV2",{}).n("ComprehendMedicalClient","DetectEntitiesV2Command").f(void 0,void 0).ser(si).de(ai).build(){}class Xi extends Ae.classBuilder().ep(Le).m(function(e,t,s,r){return[ke(s,this.serialize,this.deserialize),Ne(s,e.getEndpointParameterInstructions())]}).s("ComprehendMedical_20181030","InferICD10CM",{}).n("ComprehendMedicalClient","InferICD10CMCommand").f(void 0,void 0).ser(ii).de(ci).build(){}class Zi extends Ae.classBuilder().ep(Le).m(function(e,t,s,r){return[ke(s,this.serialize,this.deserialize),Ne(s,e.getEndpointParameterInstructions())]}).s("ComprehendMedical_20181030","InferRxNorm",{}).n("ComprehendMedicalClient","InferRxNormCommand").f(void 0,void 0).ser(ri).de(li).build(){}class Qi extends Ae.classBuilder().ep(Le).m(function(e,t,s,r){return[ke(s,this.serialize,this.deserialize),Ne(s,e.getEndpointParameterInstructions())]}).s("ComprehendMedical_20181030","InferSNOMEDCT",{}).n("ComprehendMedicalClient","InferSNOMEDCTCommand").f(void 0,void 0).ser(oi).de(di).build(){}async function Fe(){return new ni({region:ds(),credentials:await ls()})}async function er(n){const e=await Fe(),t={Text:n},s=new Ki(t);return await e.send(s)}async function tr(n){const e=await Fe(),t={Text:n},s=new Xi(t);return await e.send(s)}async function nr(n){const e=await Fe(),t={Text:n},s=new Zi(t);return await e.send(s)}async function sr(n){const e=await Fe(),t={Text:n},s=new Qi(t);return await e.send(s)}async function ir(n,e){switch(n){case"icd10cm":return await tr(e);case"rxnorm":return await nr(e);case"snomedct":return await sr(e);default:return!1}}function Jt(){const{appSettings:n}=Oe(),e=us();return m.useMemo(()=>n["app.comprehendMedicalEnabled"],[n])?!1:i.jsx(Te,{header:"Comprehend Medical",content:i.jsxs(W,{children:[i.jsxs("p",{children:[i.jsx(Re,{external:!0,href:"https://aws.amazon.com/comprehend/medical/",children:"Amazon Comprehend Medical"})," ","is a healthcare natural language processing service (NLP) that uses machine learning to identify and extract information from medical text."]}),i.jsxs("p",{children:[i.jsx(Re,{variant:"secondary",onFollow:s=>{s.preventDefault(),e("/settings")},children:"Enable Amazon Comprehend Medical"})," ","in the app settings to use this feature."]})]}),children:i.jsx(At,{type:"info"})})}function rr({clinicalDocumentNereUnits:n}){const{appSettings:e}=Oe();return m.useMemo(()=>e["app.comprehendMedicalEnabled"],[e])&&n!==0?i.jsx(Te,{header:"Comprehend Medical",content:i.jsxs(W,{children:[i.jsxs(X,{label:"Entity Extraction Estimated Cost",children:["$",(n.eachSegment*.01).toFixed(2)]}),i.jsxs("p",{children:["This demo uses the Medical Named Entity and Relationship Extraction (NERe) functionality of"," ",i.jsx(Re,{external:!0,href:"https://aws.amazon.com/comprehend/medical/",children:"Amazon Comprehend Medical"})," ","to extract data one insight at a time."]}),i.jsxs("p",{children:["The estimated cost for calling the NERe API for each section is"," ",i.jsxs("b",{children:["$",(n.eachSection*.01).toFixed(2)]}),", and for the entire summary, ",i.jsxs("b",{children:["$",(n.allAtOnce*.01).toFixed(2)]}),"."]}),i.jsxs("p",{children:["Refer to the"," ",i.jsx(Re,{external:!0,href:"https://aws.amazon.com/comprehend/medical/pricing",children:"Amazon Comprehend Medical pricing page"})," ","to learn more about pricing tiers, including free tier."," "]})]}),children:i.jsx(At,{type:"info"})}):!1}function we(n){return typeof n>"u"?"n/a":`${(n*100).toFixed(2)}%`}function Be({items:n}){return typeof n>"u"?null:i.jsx(kt,{columnDefinitions:[{id:"code",header:"Code",cell:e=>e.Code,sortingField:"code",isRowHeader:!0},{id:"description",header:"Description",cell:e=>e.Description,sortingField:"description"},{id:"score",header:"Score",cell:e=>we(e.Score),sortingField:"score"}],items:n,sortingDisabled:!0,loadingText:"Loading items",empty:i.jsx(W,{margin:{vertical:"xs"},textAlign:"center",color:"inherit",children:i.jsx(H,{size:"m",children:i.jsx("b",{children:"No items"})})}),variant:"embedded"})}function or({inferredData:n}){return i.jsxs("div",{children:[typeof n.icd10cm=="object"&&i.jsxs(Ee,{defaultExpanded:!0,headerText:"ICD-10-CM",children:[i.jsx(Be,{items:n.icd10cm.Entities?.[0]?.ICD10CMConcepts}),i.jsx(H,{size:"s",direction:"vertical",children:i.jsxs("div",{children:[i.jsx("b",{children:"Score:"})," ",we(n.icd10cm?.Entities?.[0]?.Score)]})})]}),typeof n.rxnorm=="object"&&i.jsxs(Ee,{defaultExpanded:!0,headerText:"RxNorm",children:[i.jsx(Be,{items:n.rxnorm.Entities?.[0]?.RxNormConcepts}),i.jsx(H,{size:"s",direction:"vertical",children:i.jsxs("div",{children:[i.jsx("b",{children:"Score:"})," ",we(n.rxnorm?.Entities?.[0]?.Score)]})})]}),typeof n.snomedct=="object"&&i.jsxs(Ee,{defaultExpanded:!0,headerText:"SNOMED-CT",children:[i.jsx(Be,{items:n.snomedct.Entities?.[0]?.SNOMEDCTConcepts}),i.jsx(H,{size:"s",direction:"vertical",children:i.jsxs("div",{children:[i.jsx("b",{children:"Score:"})," ",we(n.snomedct?.Entities?.[0]?.Score)]})})]})]})}const ar=[{key:"icd10cm",name:"ICD-10-CM",category:["MEDICAL_CONDITION"],type:["DX_NAME","TIME_EXPRESSION"]},{key:"rxnorm",name:"RxNorm",category:["MEDICATION"]},{key:"snomedct",name:"SNOMED CT",category:["MEDICAL_CONDITION","ANATOMY","TEST_TREATMENT_PROCEDURE"]}];function qt({category:n,type:e,text:t}){const{appSettings:s}=Oe(),r=m.useMemo(()=>s["app.comprehendMedicalEnabled"],[s]),[o,a]=y.useState({icd10cm:!1,rxnorm:!1,snomedct:!1});async function c(d,h){a({...o,[d]:"loading"});const g=await ir(d,h);a({...o,[d]:g})}return i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"flex",columnGap:"5px",justifyContent:"space-around",alignItems:"center"},children:[ar.map((d,h)=>{if(d.category.includes(n))return d.type&&!d.type.includes(e)?void 0:i.jsx($,{disabled:!!o[d.key]||!r,loading:o[d.key]==="loading",onClick:()=>c(d.key,t),children:`Infer ${d.name}`},`button_${t}_${h}`)}),i.jsx(Jt,{})]}),i.jsx(or,{inferredData:o})]})}function cr({attributes:n}){return i.jsx(Ee,{defaultExpanded:!0,headerText:"Attributes",children:i.jsx(kt,{columnDefinitions:[{id:"type",header:"Type",cell:e=>ne(e.Type.replaceAll("_"," ")),sortingField:"type",isRowHeader:!0},{id:"Entity",header:"Entity",cell:e=>e.Spans[0].Content,sortingField:"entity"}],items:n,loadingText:"Loading attributes",sortingDisabled:!0,empty:i.jsx(W,{margin:{vertical:"xs"},textAlign:"center",color:"inherit",children:i.jsx(H,{size:"m",children:i.jsx("b",{children:"No attributes"})})}),variant:"embedded"})})}function lr({wordClinicalEntity:n}){if(m.useMemo(()=>typeof n<"u"&&Object.keys(n)?.length>0,[n])){const t=n;return i.jsxs(H,{size:"m",direction:"vertical",children:[i.jsxs("div",{children:[i.jsx("b",{children:"Clinical Insight: "}),t.Spans[0].Content]}),i.jsxs(H,{size:"m",direction:"horizontal",children:[i.jsx(X,{label:"Category",children:ne(t.Category.replaceAll("_"," "))}),i.jsx(X,{label:"Type",children:ne(t.Type.replaceAll("_"," "))})]}),t.Attributes.length>0&&i.jsx(cr,{attributes:t.Attributes}),i.jsx(qt,{category:t.Category,type:t.Type,text:t.Spans[0].Content})]})}else return}const dr=m.memo(lr);function ur({isPunctuation:n,highlightWord:e,disableSegment:t=!1,isClinicalEntity:s=!1,wordBeginAudioTime:r,audioDuration:o,word:a,wordClinicalEntity:c,audioReady:d,wavesurfer:h}){const g=m.useMemo(()=>{const l={color:"",fontWeight:"normal"};return s&&(l.color=Dt,l.fontWeight="bold"),e&&(l.color=ws,l.fontWeight="bold"),t&&(l.color=Pt),l},[e,t,s]),u=m.useMemo(()=>typeof a.Confidence=="number"?a.Confidence===0?"n/a":Math.round(a.Confidence*100*100)/100+"%":"n/a",[a.Confidence]);function p(){return o&&r?i.jsx(W,{textAlign:"center",children:i.jsx($,{disabled:!d,onClick:()=>{h&&(h.current?.seekTo(o===-1?0:r/o+.001),Ce.success(`Seeked to: ${r} seconds`))},children:"Jump to"})}):!1}return i.jsxs(i.Fragment,{children:[!n&&i.jsx("span",{children:" "}),i.jsx(Te,{dismissButton:!1,position:"right",size:"large",triggerType:"custom",content:i.jsxs(H,{size:"m",direction:"vertical",children:[i.jsx(X,{label:"Confidence",children:u}),c&&i.jsx(dr,{wordClinicalEntity:c}),i.jsx(p,{})]}),children:i.jsx("span",{style:g,onCopy:()=>{Ce.success("Copied Text!")},children:a.Content})})]})}const hr=m.memo(ur),pr=m.memo(function({script:e,smallTalkCheck:t,audioTime:s,audioReady:r,wavesurfer:o}){const a=m.useRef(null),[c,d]=m.useState(!1),h=()=>{a.current.scrollIntoView({behavior:"smooth",block:o.current?.isPlaying()?"nearest":"start",inline:"center"}),d(!0)};m.useEffect(()=>{s>=e.BeginAudioTime&&s<=e.EndAudioTime&&!c?h():(s<e.BeginAudioTime||s>e.EndAudioTime)&&c&&d(!1)},[s]);const g=m.useMemo(()=>["OTHER","SMALL_TALK"].includes(e.SectionDetails.SectionName)&&t,[e.SectionDetails.SectionName,t]),u=m.useMemo(()=>r&&o.current?.getDuration()||-1,[r]);return i.jsx("div",{ref:a,style:{scrollMarginTop:"80px"},children:e.Words.map((p,l)=>{const x=p.BeginAudioTime===p.EndAudioTime,C=s>p.BeginAudioTime&&s<p.EndAudioTime&&!x,f=!!p.ClinicalEntity&&!!p.Type;return p.Alternatives?.[0]?i.jsx(hr,{isPunctuation:x,highlightWord:C,disableSegment:g,isClinicalEntity:f,wordBeginAudioTime:p.BeginAudioTime,audioDuration:u,word:p.Alternatives[0],wordClinicalEntity:p.ClinicalEntity,audioReady:r,wavesurfer:o},l):!1})})}),xt="10px";function mr({jobLoading:n,transcript:e,highlightId:t,setHighlightId:s,wavesurfer:r,smallTalkCheck:o,audioTime:a,setAudioTime:c,audioReady:d}){const[h,g]=m.useState([]),[u,p]=m.useState([]);return m.useEffect(()=>{if(n||e==null)return;g([]);const l=e.Conversation?.ClinicalInsights,x=e.Conversation?.TranscriptSegments;let f=e.Conversation?.TranscriptItems;const w=[];for(const v of x){const _=f.findIndex(R=>R.EndAudioTime>v.EndAudioTime),D=_===-1?f:f.slice(0,_);w.push({...v,Words:D}),f=f.slice(D.length)}const T=w.reduce((v,_)=>(v[_.SegmentId]=_,v),{}),b=[...new Set(x.map(v=>v.ParticipantDetails.ParticipantRole))];if(b.length>2){const D=[...new Set(b.map(R=>R.split("_")[0]))].map(R=>({speaker:R,count:b.filter(k=>k.split("_")[0]===R).length})).filter(R=>R.count>1).map(R=>R.speaker);D.length>0&&g(D)}const I={};for(const v of l)for(const _ of v.Spans){let D=0;const k=Object.entries(T[_.SegmentId].Words).filter(([,{Alternatives:M}])=>{const L=D;return typeof M<"u"&&M.length>0&&M[0].Content?.length===1&&!/^[a-zA-Z]+$/.test(M[0].Content[0])?D+=M[0].Content.length:D+=(M?.[0].Content||"0").length+1,_.BeginCharacterOffset<=L&&_.EndCharacterOffset>=L}).map(([M])=>M);for(const M of k){const L=parseInt(M);if(L!==-1)switch(v.InsightType){case"ClinicalEntity":{T[_.SegmentId].Words[L].ClinicalEntity=v,v.InsightId in I||(I[v.InsightId]=T[_.SegmentId].Words[L].BeginAudioTime);break}}else hs.error(`Insight missed: ${v}`)}}p(Object.values(T))},[n,e]),m.useEffect(()=>{function l(){s({allSegmentIds:[],selectedSegmentId:""})}if(t.selectedSegmentId){const x=u.filter(f=>t.allSegmentIds.includes(f.SegmentId))?.map(f=>({SegmentId:f.SegmentId,BeginAudioTime:f.BeginAudioTime,EndAudioTime:f.EndAudioTime}));if(x.length===0){l();return}const C=x.findIndex(f=>f.SegmentId===t.selectedSegmentId);!d&&C>=0&&c(x[C].BeginAudioTime)}},[t,e,d,c]),n||e==null?i.jsx(Nt,{containerTitle:"Transcript",text:"Loading Transcript"}):i.jsx(Ot,{containerTitle:"Transcript",children:u.map((l,x)=>{const C=l.ParticipantDetails.ParticipantRole!==u[x-1]?.ParticipantDetails.ParticipantRole,f=l.ParticipantDetails.ParticipantRole.split("_")[0],w=h.includes(f)?`${ne(f)} ${parseInt(l.ParticipantDetails.ParticipantRole.split("_")[1])+1}`:ne(f),T=l.SegmentId===t.selectedSegmentId?We:t.allSegmentIds.includes(l.SegmentId)?We:"";return i.jsx("div",{style:{paddingTop:x?"":"15px"},children:i.jsxs(jt,{disableGutters:!0,gridDefinition:[{colspan:2},{colspan:10}],children:[i.jsx("div",{style:{paddingTop:C&&x>0?xt:"",fontWeight:"bold",fontSize:h?"14px":"16px",color:["OTHER","SMALL_TALK"].includes(l.SectionDetails.SectionName)&&o?Pt:""},children:C&&i.jsx("div",{className:`${ot.row} ${ot.hidescrollbar}`,children:w})}),i.jsx("div",{style:{paddingTop:C&&x>0?xt:"",backgroundColor:T},children:i.jsx(pr,{script:l,smallTalkCheck:o,audioTime:a,audioReady:d,wavesurfer:r})})]})},x)})})}const E={root:"awsui_root_pcgz5_3bv9o_153",slider:"awsui_slider_pcgz5_3bv9o_190","slider-track":"awsui_slider-track_pcgz5_3bv9o_194","slider-range":"awsui_slider-range_pcgz5_3bv9o_194",disabled:"awsui_disabled_pcgz5_3bv9o_209",readonly:"awsui_readonly_pcgz5_3bv9o_213",error:"awsui_error_pcgz5_3bv9o_222",warning:"awsui_warning_pcgz5_3bv9o_225",active:"awsui_active_pcgz5_3bv9o_228","error-active":"awsui_error-active_pcgz5_3bv9o_231","warning-active":"awsui_warning-active_pcgz5_3bv9o_234",labels:"awsui_labels_pcgz5_3bv9o_245","labels-noref":"awsui_labels-noref_pcgz5_3bv9o_251","labels-reference":"awsui_labels-reference_pcgz5_3bv9o_254","labels-min":"awsui_labels-min_pcgz5_3bv9o_261","labels-max":"awsui_labels-max_pcgz5_3bv9o_267","labels-aria-description":"awsui_labels-aria-description_pcgz5_3bv9o_275",ticks:"awsui_ticks_pcgz5_3bv9o_293","ticks-wrapper":"awsui_ticks-wrapper_pcgz5_3bv9o_299",tick:"awsui_tick_pcgz5_3bv9o_293",middle:"awsui_middle_pcgz5_3bv9o_314",filled:"awsui_filled_pcgz5_3bv9o_317","tooltip-thumb":"awsui_tooltip-thumb_pcgz5_3bv9o_345",thumb:"awsui_thumb_pcgz5_3bv9o_358",min:"awsui_min_pcgz5_3bv9o_394",max:"awsui_max_pcgz5_3bv9o_397"};function gr({min:n,max:e,referenceValues:t,valueFormatter:s,labelsId:r,ariaDescription:o}){const c=ps()?4:10,d=(e-n)/c,h=()=>{if(!t||t.length===0)return[];const u=[];let p=n;for(let l=0;l<=t.length;l++)t[l]>n&&t[l]<e&&Math.abs(t[l]-p)>=d&&Math.abs(e-t[l])>=d&&Number.isInteger(t[l])&&(u.push(t[l]),p=t[l]);return u};function g(u){const p=Math.floor(d/2),l=u-p,x=u+p;if(e-n<=c)return{min:1,max:(e-n)*2-1,posStart:(u-n)*2,posEnd:(u-n)*2};const f=Math.round(p/2);return{min:p*2+f,max:(e-n-p)*2-f+1,posStart:(l-n)*2+1+f,posEnd:(x-n)*2-f}}return y.createElement(y.Fragment,null,y.createElement("div",{role:"list","aria-hidden":!s&&!t?"true":void 0,className:V(E.labels,{[E["labels-noref"]]:h().length===0}),style:{[oe.sliderLabelCount]:h().length===0?2:(e-n)*2},id:o?void 0:r},y.createElement("span",{role:"listitem",className:V(E.label,E["labels-min"]),style:{[oe.sliderMinEnd]:g(0).min}},s?s(n):n),h().map(u=>y.createElement("span",{role:"listitem",key:u,style:{[oe.sliderReferenceColumn]:g(u).posStart,[oe.sliderNextReferenceColumn]:g(u).posEnd},className:V(E.label,E["labels-reference"])},s?s(u):u)),y.createElement("span",{role:"listitem",className:V(E.label,E["labels-max"]),style:{[oe.sliderMaxStart]:t?g(0).max:2}},s?s(e):e)),o&&y.createElement("div",{className:E["labels-aria-description"],id:r},o))}function fr(n,e){return(n-e[0])/(e[1]-e[0])*100}function xr(n){var e;if(Math.floor(n)===n)return 0;const t=Math.abs(n).toString();return t.indexOf("-")!==-1?parseInt(t.split("-")[1],10)||0:((e=t.split(".")[1])===null||e===void 0?void 0:e.length)||0}const Yt=(n,[e,t])=>{const s=[e],r=Math.pow(10,xr(n));let o=e;for(;o<t;)o=(r*o+r*n)/r,o<=t&&s.push(o);return s},br=(n,e)=>{let t=[...n];t=t.sort((a,c)=>a-c);const s=t.indexOf(e)||0,r=t[s-1]||void 0,o=t[s+1]||void 0;return{lower:r,higher:o}},vr=n=>(n?.filter(t=>!Number.isInteger(t))).length===0,Sr=16,Cr=12;function Ve(n){const{hideFillLine:e,value:t,isActive:s,invalid:r,warning:o,disabled:a,type:c,min:d,max:h,step:g,readOnly:u}=n,p=o&&!r,l=()=>c==="min"?d:c==="max"?h:g;return y.createElement("div",{className:V(E.tick,{[E.filled]:!e&&t>l(),[E.active]:!e&&s&&t>l(),[E.error]:r&&!e&&t>l(),[E.warning]:p&&!e&&t>l(),[E["error-active"]]:r&&s&&!e&&t>l(),[E["warning-active"]]:p&&s&&!e&&t>l(),[E.disabled]:a,[E.readonly]:u,[E.middle]:c==="step"})})}function Er(n){const{min:e,max:t,step:s}=n;return y.createElement("div",{className:E["ticks-wrapper"]},y.createElement(Ve,Object.assign({},n,{type:"min"})),y.createElement("div",{className:E.ticks,style:{[oe.sliderTickCount]:Math.round((t-e)/s)}},Yt(s,[e,t]).map((r,o)=>y.createElement(Ve,Object.assign({},n,{type:"step",step:r,key:`step-${o}`})))),y.createElement(Ve,Object.assign({},n,{type:"max"})))}function yr(n){var{value:e,min:t,max:s,onChange:r,step:o,disabled:a,readOnly:c,ariaLabel:d,ariaDescription:h,referenceValues:g,tickMarks:u,hideFillLine:p,valueFormatter:l,i18nStrings:x,__internalRootRef:C=null}=n,f=De(n,["value","min","max","onChange","step","disabled","readOnly","ariaLabel","ariaDescription","referenceValues","tickMarks","hideFillLine","valueFormatter","i18nStrings","__internalRootRef"]);const w=yt(f),T=It("slider"),b=m.useRef(null),[I,v]=m.useState(!1),[_,D]=m.useState(!1),R=_t("labels"),{ariaLabelledby:k,ariaDescribedby:M,controlId:L,invalid:F,warning:se}=ms(f),ee=se&&!F;g&&vr(g);const j=(()=>{const A=o&&o<s-t&&o>t;return e===void 0?s<t?t:t+(s-t)/2:o&&o&&A&&(e-t)%o!==0?Yt(o,[t,s]).reduce(function(q,ce){return Math.abs(ce-e)<Math.abs(q-e)?ce:q}):e})(),N=fr(Math.max(Math.min(j,s),t),[t,s]),ie=()=>{if(l&&l(j))return l(j);if(l&&!l(j)){const B=[t,...g||[],j,s],q=br(B,j),ce=q.lower?l(q.lower):l(t),he=q.higher?l(q.higher):l(s),pe=j;return T("i18nStrings.valueTextRange",x?.valueTextRange(ce,pe,he),be=>be({value:pe,previousValue:ce,nextValue:he}))}},re=c?Cr:Sr;return y.createElement("div",Object.assign({},w,{ref:C,className:V(w.className,E.root)}),I&&y.createElement(gs,{value:l?l(j):j,trackRef:b,onDismiss:()=>v(!1)}),y.createElement("div",{ref:b,className:V(E["tooltip-thumb"],{[E.readonly]:c}),style:{[oe.sliderTooltipPosition]:`calc(${N}% - ${re}px)`}}),y.createElement("div",{className:E.slider},y.createElement("div",{className:V(E["slider-track"],{[E.disabled]:a,[E.readonly]:c})}),!p&&y.createElement("div",{className:V(E["slider-range"],{[E.error]:F,[E.warning]:ee,[E.active]:_,[E["error-active"]]:F&&_,[E["warning-active"]]:ee&&_,[E.disabled]:a,[E.readonly]:c}),style:{[oe.sliderRangeInlineSize]:`${N}%`}})),!!o&&u&&y.createElement(Er,{hideFillLine:p,disabled:a,readOnly:c,invalid:F,warning:se,isActive:_,step:o,min:t,max:s,value:j}),y.createElement("input",{tabIndex:0,"aria-label":d,"aria-labelledby":d&&!f.ariaLabelledby?void 0:k,"aria-describedby":l?M?`${R} ${M}`:R:M,"aria-valuetext":ie(),"aria-invalid":F?"true":void 0,"aria-disabled":c&&!a?"true":void 0,id:L,type:"range",min:t,max:s,disabled:a,onFocus:()=>{v(!0),D(!0)},onBlur:()=>{v(!1),D(!1)},onMouseEnter:()=>{v(!0)},onMouseLeave:()=>{v(!1)},onTouchStart:()=>{v(!0),D(!0)},onTouchEnd:()=>{v(!1),D(!1)},step:o,value:j,onChange:A=>{c||r&&Tt(r,{value:Number(A.target.value)})},className:V(E.thumb,{[E.error]:F,[E.warning]:ee,[E.disabled]:a,[E.readonly]:c,[E.min]:j<=t||s<t,[E.max]:j>=s&&t<s})}),y.createElement(gr,{min:t,max:s,referenceValues:g,valueFormatter:l,labelsId:R,ariaDescription:h}))}function Gt(n){var{tickMarks:e,hideFillLine:t}=n,s=De(n,["tickMarks","hideFillLine"]);const r=wt("Slider",{props:{tickMarks:e,hideFillLine:t,readOnly:s.readOnly}});return y.createElement(yr,Object.assign({tickMarks:e,hideFillLine:t},s,r))}Mt(Gt,"Slider");function Ir({hasInsightSections:n,dataExtracted:e,extractingData:t,clinicalDocumentNereUnits:s,setRightPanelSettingsOpen:r,handleExtractHealthData:o}){const{appSettings:a}=Oe(),c=m.useMemo(()=>a["app.comprehendMedicalEnabled"],[a]),d=m.useMemo(()=>n&&c,[n,c]);return i.jsxs(H,{size:"xs",alignItems:"center",direction:"horizontal",children:[i.jsx($,{iconName:"settings",variant:"icon",onClick:()=>r(!0)}),i.jsx($,{disabled:!d||e,loading:t,onClick:()=>o(),children:"Extract Health Data"}),i.jsx(Jt,{}),i.jsx(rr,{clinicalDocumentNereUnits:s})]})}function Tr({rightPanelSettingsOpen:n,setRightPanelSettingsOpen:e,acceptableConfidence:t,setAcceptableConfidence:s}){return i.jsx(fs,{onDismiss:()=>e(!1),visible:n,footer:i.jsxs(W,{children:[i.jsx($,{variant:"link",onClick:()=>s(75),children:"Reset to Defaults"}),i.jsx(W,{float:"right",children:i.jsxs(H,{direction:"horizontal",size:"xs",children:[i.jsx($,{variant:"link",onClick:()=>e(!1),children:"Cancel"}),i.jsx($,{variant:"primary",onClick:()=>e(!1),children:"OK"})]})})]}),header:"Insights Settings",children:i.jsx(xs,{label:"Comprehend Medical Confidence Score Threshold",description:"Extracted medical entities with confidence scores lower than this are not shown.",children:i.jsx(Gt,{onChange:({detail:r})=>s(r.value),value:t,max:99,min:0})})})}const _r="w",wr="x",Mr="y",jr="z",Rr="B",Dr="C",K={summaryList:_r,summaryListItem:wr,summaryListItemIndent:Mr,summaryListItemSubHeader:jr,summarizedSegment:Rr,extractedHealthDataWord:Dr};function Pr({word:n,wordData:e}){return i.jsx(Te,{dismissButton:!1,position:"right",size:"large",triggerType:"custom",content:i.jsx(H,{size:"xs",direction:"vertical",children:e.map((t,s)=>i.jsx(Ee,{defaultExpanded:!0,headerText:t.Text,children:i.jsxs(H,{size:"s",direction:"vertical",children:[i.jsxs(X,{label:"Confidence",children:[Math.round((t.Score||0)*100),"%"]}),i.jsxs(H,{size:"m",direction:"horizontal",children:[i.jsx(X,{label:"Category",children:ne((t.Category||"").replaceAll("_"," "))}),i.jsx(X,{label:"Type",children:ne((t.Type||"").replaceAll("_"," "))})]}),t.Attributes&&t.Attributes.length>0&&i.jsxs(H,{size:"m",direction:"horizontal",children:[i.jsx(X,{label:"Relationship To",children:t.Attributes[0].Text}),i.jsx(X,{label:"Type",children:ne((t.Attributes[0].Type||"").replaceAll("_"," "))}),i.jsxs(X,{label:"Score",children:[Math.round((t.Attributes[0].Score||0)*100),"%"]})]}),t.Text&&i.jsx(qt,{category:t.Category||"",type:t.Type||"",text:t.Text})]})},`expandable_${s}`))}),children:i.jsx("span",{style:{color:Dt,fontWeight:"bold"},children:n})})}const Ar=m.memo(Pr);function bt({linkedId:n,sectionExtractedData:e,word:t,acceptableConfidence:s}){const r=[];return n.forEach(o=>{const a=(e.extractedData||[]).find(c=>c.Id===o);typeof a<"u"&&a.Score&&a.Score*100>s&&r.push(a)}),i.jsxs("div",{className:K.extractedHealthDataWord,children:[r.length>0?i.jsx(Ar,{word:t,wordData:r}):t," "]})}function kr(n){const e=n.flat(),t=new Set(e);return Array.from(t)}function fe(n){return n.trim().replace(/^-/,"").trim()}function Nr(n,e){if(n.length===0||e.length===0)return[];const t=[];return n.forEach(s=>{const r=s.SectionName,o=e.find(c=>c.SectionName===r),a=[];s.Summary.forEach((c,d)=>{const h={words:[]},u=fe(c.SummarizedSegment).split(" ");if(typeof o>"u")return;const p=o?.ExtractedEntities?.[d]?.Entities||[];h.words=u.map(f=>({word:f,linkedId:[]})),h.extractedData=p;const l=new Map;h.extractedData.forEach(({BeginOffset:f,EndOffset:w,Id:T})=>{if(typeof f=="number"&&typeof w=="number")for(let b=f;b<=w;b++)l.has(b)||l.set(b,[]),l.get(b).push(T)});let x=0,C=0;for(let f=0;f<u.length;f++){const T=u[f].length;x+=T+1;const b=[];for(;C<x;)b.push(l.get(C)||[]),C++;if(h.words[f].linkedId=kr(b),x>=Math.max(...l.keys()))break}a.push(h)}),t.push({SectionName:r,Summary:a})}),t}function Or(){return i.jsx("div",{style:{paddingLeft:"5px"},children:i.jsx(W,{variant:"small",children:"No Clinical Entities"})})}function Lr({sectionName:n,summary:e,summaryExtractedHealthData:t,acceptableConfidence:s,currentSegment:r="",handleSegmentClick:o}){return e.length?i.jsx("ul",{className:K.summaryList,children:e.map(({EvidenceLinks:a,SummarizedSegment:c},d)=>{if(c==="")return!1;let h="",g=!1;if(c.endsWith(`
`)){const l=c.split(`
`);c.split(`
`).length===3&&(h=l[0],c=c.substring(c.indexOf(`
`)+1)),g=!0}const u=h?h.split(" ").length:0,p={color:Ms,backgroundColor:r===c?We:""};if(t){const l=t[d];return i.jsxs("div",{children:[u>0&&i.jsx("div",{className:K.summaryListItemSubHeader,children:l.words.slice(0,u).map(({word:x,linkedId:C},f)=>i.jsx(bt,{linkedId:C,sectionExtractedData:l,word:x,acceptableConfidence:s},`${n}_${d}_${f}`))}),i.jsx("li",{className:`${K.summaryListItem} ${g&&K.summaryListItemIndent}`,children:i.jsx("div",{onClick:()=>o(c,a),className:K.summarizedSegment,style:p,children:l.words.slice(u).map(({word:x,linkedId:C},f)=>x==="-"&&f<=1?!1:i.jsx(bt,{linkedId:C,sectionExtractedData:l,word:x,acceptableConfidence:s},`${n}_${d}_${f}`))})})]},`${n}_${d}`)}else return i.jsxs("div",{children:[h&&i.jsx("div",{className:K.summaryListItemSubHeader,children:h}),i.jsx("li",{className:`${K.summaryListItem} ${g&&K.summaryListItemIndent}`,children:i.jsx("div",{onClick:()=>o(c,a),className:K.summarizedSegment,style:p,children:fe(c)})})]},`${n}_${d}`)})}):i.jsx(Or,{})}const zr=["CHIEF_COMPLIANT","HISTORY_OF_PRESENT_ILLNESS","PAST_MEDICAL_HISTORY","PAST_FAMILY_HISTORY","PAST_SOCIAL_HISTORY","REVIEW_OF_SYSTEMS","PHYSICAL_EXAMINATION","DIAGNOSTIC_TESTING","ASSESSMENT","PLAN"],$r=["GOAL","INTERVENTION","RESPONSE","PROGRESS","PLAN"];function Hr({sections:n,extractedHealthData:e,acceptableConfidence:t,highlightId:s,setHighlightId:r,segmentById:o,wavesurfer:a}){const[c,d]=m.useState(0),[h,g]=m.useState("");m.useEffect(()=>{s.selectedSegmentId||g("")},[s]);const u=m.useMemo(()=>Nr(n,e),[n,e]);function p(x,C){let f=c;h!==x&&(g(x),d(0),f=0);const w=C[f].SegmentId,T={allSegmentIds:C.map(v=>v.SegmentId),selectedSegmentId:w};r(T);const b=a.current?.getDuration(),I=f+1;if(b){const v=o[w].BeginAudioTime/b;a.current?.seekTo(v),f<C.length-1?d(f+1):d(0),Ce.success(`Jump Successful. Sentence ${I} of ${C.length}`)}else b?Ce.error("Unable to jump to that Clinical Attribute"):(f<C.length-1?d(f+1):d(0),Ce.success(`Jump Successful. Sentence ${I} of ${C.length}. Audio not yet ready`))}const l=m.useMemo(()=>{const x=typeof n.find(C=>C.SectionName==="CHIEF_COMPLIANT")<"u"?zr:$r;return n.sort((C,f)=>x.indexOf(C.SectionName)-x.indexOf(f.SectionName)||1)},[n]);return console.debug("sortedSections",n,l),i.jsx(i.Fragment,{children:l.map(({SectionName:x,Summary:C},f)=>{const w=u.find(T=>T.SectionName===x);return i.jsxs("div",{children:[i.jsx(bs,{children:i.jsx("h3",{children:ne(x.replace(/_/g," "))})}),i.jsx(Lr,{sectionName:x,summary:C,summaryExtractedHealthData:w?.Summary,acceptableConfidence:t,currentSegment:h,handleSegmentClick:p})]},`insightsSection_${f}`)})})}function Fr(n){if(!n)return 0;const e=n.ClinicalDocumentation.Sections.reduce((r,{Summary:o})=>r+o.reduce((a,{SummarizedSegment:c})=>a+Math.ceil(fe(c).length/100),0),0),t=n.ClinicalDocumentation.Sections.reduce((r,{Summary:o})=>r+Math.ceil(o.reduce((a,{SummarizedSegment:c})=>a+fe(c).length,0)/100),0),s=Math.ceil(n.ClinicalDocumentation.Sections.reduce((r,{Summary:o})=>r+o.reduce((a,{SummarizedSegment:c})=>a+fe(c).length,0),0)/100);return{eachSegment:e,eachSection:t,allAtOnce:s}}function Br({jobLoading:n,summary:e,transcript:t,highlightId:s,setHighlightId:r,wavesurfer:o}){const[a,c]=m.useState(!1),[d,h]=m.useState([]),[g,u]=m.useState(!1),[p,l]=vs("Insights-Comprehend-Medical-Confidence-Threshold",75),x=m.useMemo(()=>t==null?{}:t.Conversation.TranscriptSegments.reduce((T,b)=>({...T,[b.SegmentId]:b}),{}),[t]),C=m.useMemo(()=>typeof e?.ClinicalDocumentation?.Sections>"u"?!1:e?.ClinicalDocumentation?.Sections?.length>0,[e]),f=m.useCallback(async()=>{if(!Array.isArray(e?.ClinicalDocumentation?.Sections))return;c(!0);const T=[];for(const b of e.ClinicalDocumentation.Sections){const I=[];for(const v of b.Summary){const _=fe(v.SummarizedSegment),D=await er(_);I.push(D)}T.push({SectionName:b.SectionName,ExtractedEntities:I})}h(T),c(!1)},[e,c,h]),w=m.useMemo(()=>Fr(e),[e]);return n||e==null?i.jsx(Nt,{containerTitle:"Insights",text:"Loading Insights"}):i.jsxs(Ot,{containerTitle:"Insights",containerActions:i.jsx(Ir,{hasInsightSections:C,dataExtracted:d.length>0,extractingData:a,clinicalDocumentNereUnits:w,setRightPanelSettingsOpen:u,handleExtractHealthData:f}),children:[i.jsx(Tr,{rightPanelSettingsOpen:g,setRightPanelSettingsOpen:u,acceptableConfidence:p,setAcceptableConfidence:l}),i.jsx(Hr,{sections:e.ClinicalDocumentation.Sections,extractedHealthData:d,acceptableConfidence:p,highlightId:s,setHighlightId:r,segmentById:x,wavesurfer:o})]})}class Kt{constructor(){this.listeners={}}on(e,t,s){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),s?.once){const r=()=>{this.un(e,r),this.un(e,t)};return this.on(e,r),r}return()=>this.un(e,t)}un(e,t){var s;(s=this.listeners[e])===null||s===void 0||s.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(s=>s(...t))}}class Vr extends Kt{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}_init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}}function Me(n,e,t,s,r=3,o=0,a=100){if(!n)return()=>{};const c=matchMedia("(pointer: coarse)").matches;let d=()=>{};const h=g=>{if(g.button!==o)return;g.preventDefault(),g.stopPropagation();let u=g.clientX,p=g.clientY,l=!1;const x=Date.now(),C=I=>{if(I.preventDefault(),I.stopPropagation(),c&&Date.now()-x<a)return;const v=I.clientX,_=I.clientY,D=v-u,R=_-p;if(l||Math.abs(D)>r||Math.abs(R)>r){const k=n.getBoundingClientRect(),{left:M,top:L}=k;l||(t?.(u-M,p-L),l=!0),e(D,R,v-M,_-L),u=v,p=_}},f=I=>{if(l){const v=I.clientX,_=I.clientY,D=n.getBoundingClientRect(),{left:R,top:k}=D;s?.(v-R,_-k)}d()},w=I=>{I.relatedTarget&&I.relatedTarget!==document.documentElement||f(I)},T=I=>{l&&(I.stopPropagation(),I.preventDefault())},b=I=>{l&&I.preventDefault()};document.addEventListener("pointermove",C),document.addEventListener("pointerup",f),document.addEventListener("pointerout",w),document.addEventListener("pointercancel",w),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",T,{capture:!0}),d=()=>{document.removeEventListener("pointermove",C),document.removeEventListener("pointerup",f),document.removeEventListener("pointerout",w),document.removeEventListener("pointercancel",w),document.removeEventListener("touchmove",b),setTimeout(()=>{document.removeEventListener("click",T,{capture:!0})},10)}};return n.addEventListener("pointerdown",h),()=>{d(),n.removeEventListener("pointerdown",h)}}function Xt(n,e){const t=e.xmlns?document.createElementNS(e.xmlns,n):document.createElement(n);for(const[s,r]of Object.entries(e))if(s==="children")for(const[o,a]of Object.entries(e))typeof a=="string"?t.appendChild(document.createTextNode(a)):t.appendChild(Xt(o,a));else s==="style"?Object.assign(t.style,r):s==="textContent"?t.textContent=r:t.setAttribute(s,r.toString());return t}function Se(n,e,t){const s=Xt(n,e||{});return t?.appendChild(s),s}class vt extends Kt{constructor(e,t,s=0){var r,o,a,c,d,h,g,u,p,l;super(),this.totalDuration=t,this.numberOfChannels=s,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.subscriptions=[],this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition((r=e.end)!==null&&r!==void 0?r:e.start),this.drag=(o=e.drag)===null||o===void 0||o,this.resize=(a=e.resize)===null||a===void 0||a,this.resizeStart=(c=e.resizeStart)===null||c===void 0||c,this.resizeEnd=(d=e.resizeEnd)===null||d===void 0||d,this.color=(h=e.color)!==null&&h!==void 0?h:"rgba(0, 0, 0, 0.1)",this.minLength=(g=e.minLength)!==null&&g!==void 0?g:this.minLength,this.maxLength=(u=e.maxLength)!==null&&u!==void 0?u:this.maxLength,this.channelIdx=(p=e.channelIdx)!==null&&p!==void 0?p:-1,this.contentEditable=(l=e.contentEditable)!==null&&l!==void 0?l:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){const e=this.start===this.end;this.element.setAttribute("part",`${e?"marker":"region"} ${this.id}`)}addResizeHandles(e){const t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},s=Se("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},t),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},e),r=Se("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},t),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},e);this.subscriptions.push(Me(s,o=>this.onResize(o,"start"),()=>null,()=>this.onEndResizing(),1),Me(r,o=>this.onResize(o,"end"),()=>null,()=>this.onEndResizing(),1))}removeResizeHandles(e){const t=e.querySelector('[part*="region-handle-left"]'),s=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),s&&e.removeChild(s)}initElement(){const e=this.start===this.end;let t=0,s=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(s=100/this.numberOfChannels,t=s*this.channelIdx);const r=Se("div",{style:{position:"absolute",top:`${t}%`,height:`${s}%`,backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(r),r}renderPosition(){const e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}toggleCursor(e){var t;this.drag&&(!((t=this.element)===null||t===void 0)&&t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){const{element:e}=this;e&&(e.addEventListener("click",t=>this.emit("click",t)),e.addEventListener("mouseenter",t=>this.emit("over",t)),e.addEventListener("mouseleave",t=>this.emit("leave",t)),e.addEventListener("dblclick",t=>this.emit("dblclick",t)),e.addEventListener("pointerdown",()=>this.toggleCursor(!0)),e.addEventListener("pointerup",()=>this.toggleCursor(!1)),this.subscriptions.push(Me(e,t=>this.onMove(t),()=>this.toggleCursor(!0),()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")})),this.contentEditable&&this.content&&(this.content.addEventListener("click",t=>this.onContentClick(t)),this.content.addEventListener("blur",()=>this.onContentBlur())))}_onUpdate(e,t){if(!this.element.parentElement)return;const{width:s}=this.element.parentElement.getBoundingClientRect(),r=e/s*this.totalDuration,o=t&&t!=="start"?this.start:this.start+r,a=t&&t!=="end"?this.end:this.end+r,c=a-o;o>=0&&a<=this.totalDuration&&o<=a&&c>=this.minLength&&c<=this.maxLength&&(this.start=o,this.end=a,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||t!=="start")&&(this.resizeEnd||t!=="end")&&this._onUpdate(e,t)}onEndResizing(){this.resize&&this.emit("update-end")}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}setContent(e){var t;if((t=this.content)===null||t===void 0||t.remove(),e){if(typeof e=="string"){const s=this.start===this.end;this.content=Se("div",{style:{padding:`0.2em ${s?.2:.4}em`,display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true"),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content)}else this.content=void 0}setOptions(e){var t,s;if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.start!==void 0||e.end!==void 0){const r=this.start===this.end;this.start=this.clampPosition((t=e.start)!==null&&t!==void 0?t:this.start),this.end=this.clampPosition((s=e.end)!==null&&s!==void 0?s:r?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),e.resize!==void 0&&e.resize!==this.resize){const r=this.start===this.end;this.resize=e.resize,this.resize&&!r?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}e.resizeStart!==void 0&&(this.resizeStart=e.resizeStart),e.resizeEnd!==void 0&&(this.resizeEnd=e.resizeEnd)}remove(){this.emit("remove"),this.subscriptions.forEach(e=>e()),this.element.remove(),this.element=null}}class nt extends Vr{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new nt(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{const s=this.regions.filter(r=>r.start<=t&&(r.end===r.start?r.start+.05:r.end)>=t);s.forEach(r=>{e.includes(r)||this.emit("region-in",r)}),e.forEach(r=>{s.includes(r)||this.emit("region-out",r)}),e=s}))}initRegionsContainer(){return Se("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){e.content&&setTimeout(()=>{const t=e.content,s=t.getBoundingClientRect(),r=this.regions.map(o=>{if(o===e||!o.content)return 0;const a=o.content.getBoundingClientRect();return s.left<a.left+a.width&&a.left<s.left+s.width?a.height:0}).reduce((o,a)=>o+a,0);t.style.marginTop=`${r}px`},10)}adjustScroll(e){var t,s;const r=(s=(t=this.wavesurfer)===null||t===void 0?void 0:t.getWrapper())===null||s===void 0?void 0:s.parentElement;if(!r)return;const{clientWidth:o,scrollWidth:a}=r;if(a<=o)return;const c=r.getBoundingClientRect(),d=e.element.getBoundingClientRect(),h=d.left-c.left,g=d.right-c.left;h<0?r.scrollLeft+=h:g>o&&(r.scrollLeft+=g-o)}virtualAppend(e,t,s){const r=()=>{if(!this.wavesurfer)return;const o=this.wavesurfer.getWidth(),a=this.wavesurfer.getScroll(),c=t.clientWidth,d=this.wavesurfer.getDuration(),h=Math.round(e.start/d*c),g=h+(Math.round((e.end-e.start)/d*c)||1)>a&&h<a+o;g&&!s.parentElement?t.appendChild(s):!g&&s.parentElement&&s.remove()};setTimeout(()=>{if(!this.wavesurfer)return;r();const o=this.wavesurfer.on("scroll",r);this.subscriptions.push(e.once("remove",o),o)},0)}saveRegion(e){this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);const t=[e.on("update",s=>{s||this.adjustScroll(e),this.emit("region-update",e,s)}),e.on("update-end",()=>{this.avoidOverlapping(e),this.emit("region-updated",e)}),e.on("play",s=>{var r;(r=this.wavesurfer)===null||r===void 0||r.play(e.start,s)}),e.on("click",s=>{this.emit("region-clicked",e,s)}),e.on("dblclick",s=>{this.emit("region-double-clicked",e,s)}),e.once("remove",()=>{t.forEach(s=>s()),this.regions=this.regions.filter(s=>s!==e),this.emit("region-removed",e)})];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,s;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const r=this.wavesurfer.getDuration(),o=(s=(t=this.wavesurfer)===null||t===void 0?void 0:t.getDecodedData())===null||s===void 0?void 0:s.numberOfChannels,a=new vt(e,r,o);return r?this.saveRegion(a):this.subscriptions.push(this.wavesurfer.once("ready",c=>{a._setTotalDuration(c),this.saveRegion(a)})),a}enableDragSelection(e,t=3){var s;const r=(s=this.wavesurfer)===null||s===void 0?void 0:s.getWrapper();if(!(r&&r instanceof HTMLElement))return()=>{};let o=null,a=0;return Me(r,(c,d,h)=>{o&&o._onUpdate(c,h>a?"end":"start")},c=>{var d,h;if(a=c,!this.wavesurfer)return;const g=this.wavesurfer.getDuration(),u=(h=(d=this.wavesurfer)===null||d===void 0?void 0:d.getDecodedData())===null||h===void 0?void 0:h.numberOfChannels,{width:p}=this.wavesurfer.getWrapper().getBoundingClientRect(),l=c/p*g,x=(c+5)/p*g;o=new vt(Object.assign(Object.assign({},e),{start:l,end:x}),g,u),this.regionsContainer.appendChild(o.element)},()=>{o&&(this.saveRegion(o),o=null)},t)}clearRegions(){this.regions.slice().forEach(e=>e.remove()),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}const Ur="r",Wr="s",Jr="t",qr="u",Yr="v",ge={ctrlHeading:Ur,playerControl:Wr,playerControlInline:Jr,closeButton:qr,downloadButton:Yr},Ue=[.5,1,1.2,1.5,2];function Gr({wavesurfer:n,showControls:e,audioLoading:t,setShowControls:s,playingAudio:r,setPlayingAudio:o,playBackSpeed:a,setPlayBackSpeed:c,isEmbeded:d=!1,audioBlob:h=null}){const g=h?URL.createObjectURL(h):null,u=i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[i.jsx($,{onClick:p=>{p.preventDefault(),n.current?.skip(-5)},children:i.jsx(de,{name:"undo"})}),r?i.jsx($,{onClick:p=>{p.preventDefault(),n.current?.pause(),o(!r)},children:i.jsx(de,{name:"view-full"})}):i.jsx($,{onClick:p=>{p.preventDefault(),n.current?.play(),o(!r)},children:i.jsx(de,{name:"caret-right-filled"})}),i.jsxs($,{onClick:p=>{p.preventDefault();const l=a===Ue.length-1?0:a+1;n.current?.setPlaybackRate(Ue[l]),c(l)},children:[Ue[a],"x"]}),i.jsx($,{onClick:p=>{p.preventDefault(),n.current?.skip(5)},children:i.jsx(de,{name:"redo"})}),g?i.jsx("a",{className:ge.downloadButton,href:g,download:"recording."+h?.type.split(";")[0].split("/")[1],children:i.jsx(de,{name:"download"})}):null]});if(!t)return e?d?i.jsx("div",{className:ge.playerControlInline,children:u}):i.jsx("div",{className:ge.playerControl,children:i.jsxs(ye,{children:[i.jsx("div",{className:ge.closeButton,children:i.jsx($,{onClick:p=>{p.preventDefault(),s(!1)},variant:"icon",iconName:"close"})}),i.jsx("div",{className:ge.ctrlHeading,children:i.jsx(W,{variant:"h4",children:"Audio Controls"})}),u]})}):i.jsx("div",{className:ge.playerControl,children:i.jsx(ye,{children:i.jsx($,{iconName:"angle-up",onClick:p=>{p.preventDefault(),s(!0)}})})})}const Kr="j",Xr={segmentControls:Kr},St=(n,e)=>{const r=n.length,o=e/r,a=.25/o,c=[];n.forEach((u,p)=>{Math.abs(u)<.0015&&c.push(p)});const d=[];return c.forEach(function(u,p){d.length&&u<=c[p-1]+a?d[d.length-1].push(u):d.push([u])}),d.filter(u=>u.length>=a).map(u=>({start:u[0],end:u[u.length-1]})).map(u=>({start:Math.round(u.start*o*10)/10,end:Math.round(u.end*o*10)/10}))};function Zr({jobLoading:n,jobDetails:e,transcript:t,wavesurfer:s,smallTalkCheck:r,setSmallTalkCheck:o,setAudioTime:a,setAudioReady:c}){const{addFlashMessage:d}=Rt(),[h,g]=m.useState(),[u,p]=m.useState(!0),[l,x]=m.useState(!1),[C,f]=m.useState(!1),[w,T]=m.useState(1),[b,I]=m.useState(!1),[v,_]=m.useState([]),[D,R]=m.useState(0),[k,M]=m.useState(0),L=document.getElementById("waveform"),F=m.useMemo(()=>{if(!t)return[];const j=t.Conversation.TranscriptSegments;if(j.length>0){const N=[];for(const{SectionDetails:ie,BeginAudioTime:re,EndAudioTime:A}of j)["OTHER","SMALL_TALK"].includes(ie.SectionName)&&N.push({BeginAudioTime:re,EndAudioTime:A});return N}else return[]},[t]);function se(){if(!e?.Media?.MediaFileUri)throw Error("Unable to find HealthScribe audio URL")}m.useEffect(()=>{async function j(){try{se();const N=je(e?.Media?.MediaFileUri),ie=await Ct(N);s.current||(s.current=Ss.create({backend:"MediaElement",container:L||"#waveform",height:40,normalize:!1,waveColor:"rgba(35, 47, 62, 0.8)",progressColor:"#2074d5",url:ie}),g(s.current.registerPlugin(nt.create()))),s.current.on("ready",()=>{const A=s.current.getDuration(),B=s.current.exportPeaks(),q=St(B[0],A).reduce((he,{start:pe,end:be})=>he+be-pe,0);_(B[0]),R(q/A);const ce=F.reduce((he,{EndAudioTime:pe,BeginAudioTime:be})=>he+(pe-be),0);M(ce/A),x(!0),p(!1),c(!0)}),s.current?.on("play",()=>{console.log("Wavesurfer PLAY event fired"),f(!0)}),s.current?.on("pause",()=>{console.log("Wavesurfer PAUSE event fired"),f(!1)}),s.current?.on("finish",()=>{console.log("Wavesurfer FINISH event fired"),f(!1)});const re=()=>{a(s.current?.getCurrentTime()??0)};s.current?.on("audioprocess",re),s.current?.on("seeking",re)}catch(N){p(!1),d({id:N?.toString()||"GetHealthScribeJob error",header:"Conversation Error",content:N?.toString()||"GetHealthScribeJob error",type:"error"})}}!n&&L&&j().catch(console.error)},[n,L]),m.useEffect(()=>{if(!(!s.current||!h)){if(h.clearRegions(),r)for(const{BeginAudioTime:j,EndAudioTime:N}of F)h.addRegion({id:`${j}-${N}-smalltalk`,start:j,end:N,drag:!1,resize:!1,color:"rgba(255, 153, 0, 0.5)"});if(b)for(const{start:j,end:N}of St(v,s.current.getDuration()))h.addRegion({id:`${j}-${N}-silence`,start:j,end:N,drag:!1,resize:!1,color:"rgba(255, 153, 0, 0.5)"});h.on("region-in",({end:j})=>{s.current.getCurrentTime()<j&&s.current?.seekTo(j/s.current?.getDuration())})}},[s,r,F,b,v]);function ee(){return i.jsx("div",{style:{flex:"display",textAlign:"center",paddingTop:"30px",paddingBottom:"30px",color:"var(--color-text-status-inactive-5ei55p, #5f6b7a)"},children:i.jsxs(W,{children:[i.jsx(Et,{})," Loading Audio"]})})}function ue(){if(!n&&!u)return i.jsx("div",{className:Xr.segmentControls,children:i.jsxs(H,{size:"s",direction:"horizontal",children:[i.jsx(W,{variant:"awsui-key-label",children:"Remove"}),i.jsxs(rt,{checked:r,onChange:()=>o(!r),children:["Small Talk (",i.jsxs("i",{children:[Math.ceil(k*100),"%"]}),")"]}),i.jsxs(rt,{checked:b,onChange:()=>I(!b),children:["Silences (",i.jsxs("i",{children:[Math.ceil(D*100),"%"]}),")"]})]})})}return i.jsxs(ye,{children:[(n||u)&&i.jsx(ee,{}),!n&&!u&&i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx(W,{variant:"awsui-key-label",margin:{bottom:"s"},children:"Audio Controls"}),i.jsx(Gr,{wavesurfer:s,audioLoading:u,showControls:!0,setShowControls:x,playingAudio:C,setPlayingAudio:f,playBackSpeed:w,setPlayBackSpeed:T,isEmbeded:!0})]}),i.jsx(ue,{}),i.jsx("div",{style:{height:u?0:""},children:i.jsx("div",{id:"waveform",style:{marginTop:"5px",height:u?0:""}})})]})}const Qr=m.lazy(()=>Ts(()=>import("./index-xRJ0uOrR.js"),__vite__mapDeps([0,1,2,3])));function oo(){const{conversationName:n}=Cs(),{addFlashMessage:e}=Rt(),[t,s]=m.useState(!0),[r,o]=m.useState(null),[a,c]=m.useState(!1),[d,h]=m.useState(!1),[g,u]=m.useState(),[p,l]=m.useState(),[x,C,f,w,T,b,I,v,_]=Rs();return m.useEffect(()=>{async function D(R){try{s(!0);const M=(await Is({MedicalScribeJobName:R}))?.MedicalScribeJob;if(typeof M>"u")return;Object.keys(M).length>0&&o(M);const L=M.MedicalScribeOutput?.TranscriptFileUri,F=await it(je(L||""));u(JSON.parse(await F?.Body?.transformToString()||""));const se=M.MedicalScribeOutput?.ClinicalDocumentUri,ee=await it(je(se||""));l(JSON.parse(await ee?.Body?.transformToString()||""))}catch(k){o(null),s(!1),e({id:k?.toString()||"GetHealthScribeJob error",header:"Conversation Error",content:k?.toString()||"GetHealthScribeJob error",type:"error"})}s(!1)}if(n)D(n).catch(console.error);else return},[]),i.jsxs(Es,{headerVariant:"high-contrast",header:i.jsx(Ds,{jobDetails:r,setShowOutputModal:c,setDeleteModalActive:h}),children:[a&&i.jsx(m.Suspense,{fallback:i.jsx(ys,{}),children:i.jsx(Qr,{setVisible:c,transcriptString:JSON.stringify(g||"Loading...",null,2),clinicalDocumentString:JSON.stringify(p||"Loading...",null,2)})}),i.jsxs(jt,{gridDefinition:[{colspan:{default:12}},{colspan:{default:6}},{colspan:{default:6}}],children:[i.jsx(Zr,{jobLoading:t,jobDetails:r,transcript:g,wavesurfer:x,smallTalkCheck:b,setSmallTalkCheck:I,setAudioTime:T,setAudioReady:f}),i.jsx(mr,{jobLoading:t,transcript:g,highlightId:v,setHighlightId:_,wavesurfer:x,smallTalkCheck:b,audioTime:w,setAudioTime:T,audioReady:C}),i.jsx(Br,{jobLoading:t,summary:p,transcript:g,highlightId:v,setHighlightId:_,wavesurfer:x})]})]})}export{oo as default};
